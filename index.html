<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Платформа тестирования</title>
<style>
:root {
  --bg:#0a0a1a;
  --card:#fff;
  --accent:#2563eb;
  --danger:#ef4444;
  --muted:#6b7280;
}
body {
  font-family: Inter, system-ui, sans-serif;
  margin:0;
  background: var(--bg);
  color:#111;
  overflow-x:hidden;
}
canvas#starfield {
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  z-index:-1;
  background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
}
.container {
  max-width:1100px;
  margin:28px auto;
  padding:20px;
}
.header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  margin-bottom:18px;
}
.card {
  background:var(--card);
  border-radius:10px;
  padding:16px;
  box-shadow:0 6px 18px rgba(15,23,42,0.2);
}
h1{margin:0;font-size:20px}
button {
  cursor:pointer;
  border:0;
  background:var(--accent);
  color:#fff;
  padding:8px 12px;
  border-radius:8px;
}
button.ghost{background:transparent;color:var(--accent);border:1px solid #e6eefc;}
.cols{display:flex;gap:12px;}
.col{flex:1;}
input, select, textarea{
  width:100%;padding:8px 10px;border-radius:8px;
  border:1px solid #e6eefc;box-sizing:border-box;
}
textarea{min-height:160px;font-family:inherit;}
.small{font-size:13px;color:var(--muted)}
.muted{color:var(--muted)}
.field-row{display:flex;gap:8px;align-items:center;margin-top:8px}
.field-row input[type="text"]{flex:1}
.tiny{font-size:12px;padding:6px 8px;border-radius:6px}
.topnav button{background:transparent;color:var(--accent);border:1px solid transparent;}
.topnav button.active{font-weight:600;border-bottom:2px solid var(--accent);}
.note{font-size:13px;color:var(--muted);margin-top:6px}
.hidden{display:none;}
</style>
</head>
<body>
<canvas id="starfield"></canvas>
<div class="container">
  <div class="header">
    <div>
      <h1>Платформа для зачётов</h1>
      <div class="small muted">Авторизация, загрузка тестов текстом, контроль доступа, мониторинг</div>
    </div>
    <div class="flex">
      <div id="current-user" class="small muted"></div>
      <div id="nav-buttons" class="topnav"></div>
    </div>
  </div>
  <div id="main" class="card"></div>
  <div style="margin-top:12px" class="small muted">Перед запуском теста включите геоданные</div>
</div>

<script>
/* ========== Минимальная логика (сократил ради примера) ========== */
async function hashPasswordToHex(p) {
  const data = new TextEncoder().encode(p);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  return Array.from(new Uint8Array(hashBuffer)).map(b=>b.toString(16).padStart(2,'0')).join('');
}
const DB = {
  get:k=>JSON.parse(localStorage.getItem(k)||'null'),
  set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))
};
async function ensureAdmin(){
  if(!DB.get('users')){
    const adminHash = await hashPasswordToHex('admin123');
    DB.set('users',[{username:'admin',passwordHash:adminHash,role:'admin',active:true}]);
  }
}
let AppState={currentUser:null,page:'home'};
function renderNav(){
  const nav=document.getElementById('nav-buttons'); nav.innerHTML='';
  const user=AppState.currentUser;
  const cu=document.getElementById('current-user');
  if(!user){
    const b=document.createElement('button'); b.textContent='Вход';
    b.onclick=()=>{AppState.page='login';renderMain()};
    nav.appendChild(b);
    cu.innerText='Не вошёл';
  }else{
    cu.innerText=user.username+" ("+user.role+")";
    const b=document.createElement('button'); b.textContent='Выйти';
    b.onclick=()=>{AppState.currentUser=null;AppState.page='home';renderMain();};
    nav.appendChild(b);
  }
}
function renderMain(){
  const main=document.getElementById('main'); main.innerHTML='';
  if(AppState.page==='home'){ main.innerHTML='<h2>Добро пожаловать</h2><p>Войдите как студент или админ.</p>'; }
  if(AppState.page==='login'){ renderLogin(main);}
}
function renderLogin(c){
  const inpU=document.createElement('input'); inpU.placeholder='Логин';
  const inpP=document.createElement('input'); inpP.type='password'; inpP.placeholder='Пароль';
  const btn=document.createElement('button'); btn.textContent='Войти';
  const msg=document.createElement('div'); msg.className='note';
  btn.onclick=async()=>{
    const users=DB.get('users')||[];
    const u=users.find(x=>x.username===inpU.value);
    if(!u){msg.textContent='Пользователь не найден';return;}
    const h=await hashPasswordToHex(inpP.value);
    if(h!==u.passwordHash){msg.textContent='Неверный пароль';return;}
    if(!u.active){msg.textContent='Доступ отключён';return;}
    AppState.currentUser=u;AppState.page='home';renderMain();renderNav();
  }
  c.appendChild(inpU);c.appendChild(inpP);c.appendChild(btn);c.appendChild(msg);
}
(async function init(){ await ensureAdmin(); renderNav(); renderMain(); })();
</script>

<script>
/* ========== Анимация звёздного неба ========== */
const canvas=document.getElementById('starfield');
const ctx=canvas.getContext('2d');
let stars=[];
function resize(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
window.onresize=resize;resize();
for(let i=0;i<300;i++){
  stars.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,z:Math.random()*canvas.width});
}
function draw(){
  ctx.fillStyle="#000011";ctx.fillRect(0,0,canvas.width,canvas.height);
  for(let i=0;i<stars.length;i++){
    let s=stars[i]; s.z-=2; if(s.z<=0){s.z=canvas.width;}
    let k=128.0/s.z; let px=s.x*k+canvas.width/2; let py=s.y*k+canvas.height/2;
    if(px>=0 && px<canvas.width && py>=0 && py<canvas.height){
      let size=(1-s.z/canvas.width)*3;
      ctx.fillStyle="rgba(255,255,255,"+(1-s.z/canvas.width)+")";
      ctx.beginPath(); ctx.arc(px,py,size,0,2*Math.PI); ctx.fill();
    }
  }
  requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
